<app-header></app-header>
<div class="news-details-container" [@routeAnimations]>
  <app-breadcrumbs></app-breadcrumbs>
  <main class="news-content bg-white overflow-hidden">
    <div class="container mx-auto px-4 py-8">
      <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-6">
        <div class="flex flex-col md:flex-row items-center gap-4">
          <button
            class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-[var(--color-nimicgreen)] hover:bg-[#413258] transition-colors duration-200 font-[DiodrumArabic] cursor-pointer border-0">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                clip-rule="evenodd" />
            </svg>
            {{ 'CONSULTING_STUDIES.ADD_NEW' | translate }}
          </button>
          <div class="w-full md:w-[300px]">
            <app-text-input [label]="'CONSULTING_STUDIES.SEARCH' | translate"
              [placeholder]="'CONSULTING_STUDIES.SEARCH_PLACEHOLDER' | translate" [name]="'search'" class="mb-4">
            </app-text-input>
          </div>
        </div>
      </div>

      <!-- Desktop Table View -->
      <div class="hidden md:block overflow-x-auto rounded-lg shadow-sm">
        <table class="min-w-full bg-white border border-gray-200">
          <thead>
            <tr class="bg-gray-50 border-b border-gray-200">
              <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600 border-l">{{ 'CONSULTING_STUDIES.NAME'
                | translate }}</th>
              <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600 border-l">{{ 'CONSULTING_STUDIES.TYPE'
                | translate }}</th>
              <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600 border-l">{{
                'CONSULTING_STUDIES.SUBJECT' | translate }}</th>
              <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600 border-l">{{
                'CONSULTING_STUDIES.DESCRIPTION' | translate }}</th>
              <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600 border-l">{{
                'CONSULTING_STUDIES.CATEGORY' | translate }}</th>
              <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600 border-l">{{
                'CONSULTING_STUDIES.OPTIONS' | translate }}</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @for (study of studies; track study.Id; let i = $index) {
            <tr [class]="i % 2 === 0 ? 'bg-white hover:bg-gray-50' : 'bg-gray-50 hover:bg-gray-100'"
              class="transition-colors duration-200">
              <td class="px-6 py-4 text-sm text-gray-900 border-l">{{study.NameAr}}</td>
              <td class="px-6 py-4 text-sm text-gray-600 border-l">{{study.StudyType}}</td>
              <td class="px-6 py-4 text-sm text-gray-600 border-l">{{study.StudySubject}}</td>
              <td class="px-6 py-4 text-sm text-gray-600 border-l max-w-xs truncate">{{study.Description}}</td>
              <td class="px-6 py-4 text-sm text-gray-600 border-l">
                <span class="px-3 py-1 text-xs font-medium rounded-full" [ngClass]="{
                          'bg-blue-100 text-blue-800': study.PrivacyType === 'عام',
                          'bg-green-100 text-green-800': study.PrivacyType === 'مقيد',
                          'bg-purple-100 text-purple-800': study.PrivacyType === 'دراسات تنموية'
                        }">
                  {{study.PrivacyType}}
                </span>
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 border-l">
                <button
                  class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-[var(--color-nimicgreen)] bg-transparent hover:bg-[var(--color-nimicgreen)]/5 rounded-md transition-colors duration-200 font-[DiodrumArabic] border border-[var(--color-nimicgreen)] cursor-pointer"
                  (click)="openCertificateModal(study.Id)">
                  {{ 'CONSULTING_STUDIES.DEPOSIT_CERTIFICATE' | translate }}
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="md:hidden space-y-4">
        @for (study of studies; track study.Id) {
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
          <div class="space-y-3">
            <div class="flex justify-between items-start">
              <h3 class="text-sm font-medium text-gray-900">{{study.NameAr}}</h3>
              <span class="px-3 py-1 text-xs font-medium rounded-full" [ngClass]="{
                        'bg-blue-100 text-blue-800': study.PrivacyType === 'عام',
                        'bg-green-100 text-green-800': study.PrivacyType === 'مقيد',
                        'bg-purple-100 text-purple-800': study.PrivacyType === 'دراسات تنموية'
                      }">
                {{study.PrivacyType}}
              </span>
            </div>

            <div class="text-sm text-gray-600">
              <p class="mb-1"><span class="font-medium">{{ 'CONSULTING_STUDIES.TYPE' | translate }}:</span>
                {{study.StudyType}}</p>
              <p class="mb-1"><span class="font-medium">{{ 'CONSULTING_STUDIES.SUBJECT' | translate }}:</span>
                {{study.StudySubject}}</p>
              <p class="mb-1"><span class="font-medium">{{ 'CONSULTING_STUDIES.DESCRIPTION' | translate }}:</span>
                {{study.Description}}</p>
            </div>

            <div class="pt-2">
              <button
                class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-[var(--color-nimicgreen)] bg-transparent hover:bg-[var(--color-nimicgreen)]/5 rounded-md transition-colors duration-200 font-[DiodrumArabic] border border-[var(--color-nimicgreen)] cursor-pointer"
                (click)="openCertificateModal(study.Id)">
                {{ 'CONSULTING_STUDIES.DEPOSIT_CERTIFICATE' | translate }}
              </button>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </main>
</div>
<app-footer></app-footer>

@if (isCertificateModalOpen && selectedStudy) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg max-w-lg w-full p-8 relative animate-fade-in">
    <button (click)="closeCertificateModal()"
      class="absolute top-2 left-2 text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
    <h2 class="text-xl font-bold mb-4 text-center">{{ 'CONSULTING_STUDIES.CERTIFICATE_MODAL_TITLE' | translate }}</h2>
    <div class="space-y-2 text-right">
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.NAME' | translate }}: </span> {{selectedStudy.NameAr}}
      </div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.SUBJECT' | translate }}: </span>
        {{selectedStudy.StudySubject}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.COMPANY_NAME' | translate }}: </span>
        {{selectedStudy.CompanyName}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.STUDY_DATE' | translate }}: </span>
        {{selectedStudy.StudyDate}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.SECTOR' | translate }}: </span> {{selectedStudy.Sector}}
      </div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.TYPE' | translate }}: </span> {{selectedStudy.StudyType}}
      </div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.MAIN_SUBJECT' | translate }}: </span>
        {{selectedStudy.MainSubject}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.KEYWORDS' | translate }}: </span>
        {{selectedStudy.Keywords}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.PRIVACY_TYPE' | translate }}</span>
        {{selectedStudy.PrivacyType}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.CONTRACT_NAME' | translate }}: </span>
        {{selectedStudy.ContractName}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.CONTRACT_NO' | translate }}: </span>
        {{selectedStudy.ContractNo}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.BUDGET_ITEM_NO' | translate }}: </span>
        {{selectedStudy.BudgetItemNo}}</div>
      <div><span class="font-semibold">{{ 'CONSULTING_STUDIES.DESCRIPTION' | translate }}: </span>
        {{selectedStudy.Description}}</div>
    </div>
    <div class="mt-6 flex justify-center">
      <button (click)="downloadStudy()"
        class="px-6 py-2 bg-[var(--color-nimicgreen)] text-white rounded hover:bg-[#413258] transition">
        {{ 'CONSULTING_STUDIES.DOWNLOAD_STUDY' | translate }}
      </button>
      <button (click)="closeCertificateModal()"
        class="px-6 py-2 bg-[var(--color-nimicgreen)] text-white rounded hover:bg-[#413258] transition">
        {{ 'CONSULTING_STUDIES.CLOSE' | translate }}
      </button>
    </div>
  </div>
</div>
}