<header class="header" >
<!--   <div class="bg-yellow-100 p-2 text-center text-sm">
    Test Environment - {{ currentLang | uppercase }}  <br/>

    {{ 'FOOTER.MIM_COPYRIGHT' | translate }}
  </div> -->
  <div>
    <!-- Top Header Panel -->
    <div class="text-gray-700 text-sm ">
      <div class="container mx-auto flex items-center justify-end gap-4 p-4">
        <a [routerLink]="['/', currentLang, 'help', 'contactus']" [href]="'/' + currentLang + '/help/contactus'" class="text-[var(--color-nimicgreen)] hover:text-[#413258] transition-colors duration-300 no-underline mt-3 font-[500]">{{ 'HEADER.CONTACT_US' | translate }}</a>
        <a [routerLink]="['/', currentLang === 'en' ? 'ar' : 'en']" [href]="'/' + (currentLang === 'en' ? 'ar' : 'en')" class="text-[var(--color-nimicgreen)] hover:text-[#413258] transition-colors duration-300 no-underline cursor-pointer mt-3 font-[500]" (click)="switchLanguage(currentLang === 'en' ? 'ar' : 'en')">
          {{ currentLang === 'en' ? 'عربي' : 'EN' }}
        </a>
      </div>
    </div>
   <!--  <a [routerLink]="['/', currentLang, 'mediacenter', 'news']">News</a> -->
    <!-- Main Navbar -->
    <div class="container mx-auto flex items-center justify-between p-4 relative">
      
      <div class="flex items-center gap-8">
        <!-- Logo -->
        <div class="flex items-center">
          <a routerLink="/" [href]="'/' + currentLang">
            <img src="/assets/images/newLogoGreen.png" [alt]="'GENERAL.NIMIC' | translate" [title]="'GENERAL.NIMIC' | translate" class="greenLogo h-14 lg:h-16" />
            <img src="/assets/images/newLogoWhite.png" [alt]="'GENERAL.NIMIC' | translate" [title]="'GENERAL.NIMIC' | translate" class="whiteLogo h-14 lg:h-16" />
          </a>

        </div>

        <!-- Navigation Links -->
        @if (!loading) {

          <div class="hidden lg:flex items-center gap-8 text-[#1A1A1A] text-base relative mainMenuItems">
            <ul class="flex items-center gap-2 mainNav">
              @for (menuItem of menuItems; track menuItem) {
                <li class="relative hover:bg-white transition-all duration-800 ease-out " (mouseenter)="openSubmenu(menuItem.title)" (mouseleave)="closeSubmenu(menuItem.title)">
                  <a [routerLink]="getLastSegment(menuItem.url)" [href]="'/' + currentLang + menuItem.url" class="mainMenuItem flex items-center transition-all duration-300 ease-out gap-1 hover:text-[#1A1A1A] cursor-pointer no-underline">
                    {{ menuItem.title }}
                    @if (menuItem.children?.length) {
                      <svg class="w-3 h-3 transition-transform duration-300" [ngClass]="{'rotate-180': submenuOpen[menuItem.title]}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                      </svg>
                    }
                  </a>
                  @if (menuItem.children?.length) {
                    <ul class="subMenuContainer z-[7] absolute bg-white shadow-lg overflow-hidden transition-all duration-300 ease-out border-b border-gray-200"
                        [ngClass]="{'right-0': currentLang === 'ar', 'left-0': currentLang === 'en'}"
                        (mouseenter)="openSubmenu(menuItem.title)" (mouseleave)="closeSubmenu(menuItem.title)"
                        [ngClass]="{
                          'opacity-100 scale-100 visible': submenuOpen[menuItem.title],
                          'opacity-0 scale-95 invisible': !submenuOpen[menuItem.title],
                          'w-96': menuItem.children && menuItem.children.length > 5,
                          'w-48': menuItem.children && menuItem.children.length <= 5
                        }">
                      <div class="absolute top-0 right-5 -translate-y-1/2 w-3 h-3 bg-white rotate-45 border-t border-r"></div>
                      <div [ngClass]="menuItem.children && menuItem.children.length > 5 ? 'grid grid-cols-2 gap-2 pb-2 p-2' : 'pb-2 p-2'">
                        @for (child of menuItem.children; track child) {
                          <li>
                            <a [routerLink]="getLastSegment(child.url)" [href]="getLastSegment(child.url)" class="block px-4 py-2 text-[#1A1A1A] hover:bg-gray-100 no-underline border-b border-gray-100 last:border-b-0">
                              {{ child.title }}
                            </a>
                          </li>
                        }
                      </div>
                    </ul>
                  }
                </li>
              }
            </ul>
          </div>
        }
    
      </div>

      <!-- Mobile Menu Button -->
      <div class="lg:hidden">
        <button (click)="toggleMobileMenu()" class="text-gray-700 hover:text-black bg-transparent border-0 p-3" aria-label="Toggle mobile menu" aria-expanded="false" [attr.aria-expanded]="isMobileMenuOpen">
          <svg fill="var(--color-nimicgreen)" width="48px" height="48px" viewBox="-5.5 0 48 48" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <title>Mobile Menu</title>
            <path d="M1.375 9.156h18.063c0.781 0 1.375-0.594 1.375-1.375 0-0.75-0.594-1.344-1.375-1.344h-18.063c-0.781 0-1.375 0.594-1.375 1.344 0 0.781 0.594 1.375 1.375 1.375zM1.375 14.625h18.063c0.781 0 1.375-0.594 1.375-1.375 0-0.75-0.594-1.344-1.375-1.344h-18.063c-0.781 0-1.375 0.594-1.375 1.344 0 0.781 0.594 1.375 1.375 1.375zM1.375 20.094h18.063c0.781 0 1.375-0.594 1.375-1.344 0-0.781-0.594-1.375-1.375-1.375h-18.063c-0.781 0-1.375 0.594-1.375 1.375 0 0.75 0.594 1.344 1.375 1.344zM1.375 25.563h18.063c0.781 0 1.375-0.594 1.375-1.344 0-0.781-0.594-1.375-1.375-1.375h-18.063c-0.781 0-1.375 0.594-1.375 1.375 0 0.75 0.594 1.344 1.375 1.344z"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu Overlay -->
      <div class="fixed inset-0 bg-black bg-opacity-50 z-50 lg:hidden" 
           [ngClass]="{'hidden': !isMobileMenuOpen}"
           (click)="toggleMobileMenu()">
      </div>

      <!-- Mobile Menu -->
      <div class="fixed left-0 top-0 h-full w-72 bg-white shadow-xl transform transition-transform duration-300 ease-in-out z-50 lg:hidden"
           [ngClass]="{'translate-x-0': isMobileMenuOpen, '-translate-x-full': !isMobileMenuOpen}">
        
        <!-- Mobile Menu Header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-100">
          <img src="/assets/images/newLogoGreen.png" [alt]="'GENERAL.NIMIC' | translate" class="h-10" />
          <button (click)="toggleMobileMenu()" class="text-gray-700 hover:text-black bg-transparent border-0 p-3" aria-label="Toggle mobile menu" aria-expanded="false" [attr.aria-expanded]="isMobileMenuOpen">
            <span class="absolute top-1/2 left-1/2 w-6 h-0.5 bg-[var(--color-nimicgreen)] transform -translate-x-1/2 -translate-y-1/2 rotate-45"></span>
            <span class="absolute top-1/2 left-1/2 w-6 h-0.5 bg-[var(--color-nimicgreen)] transform -translate-x-1/2 -translate-y-1/2 -rotate-45"></span>
          </button>
        </div>

        <!-- Mobile Menu Content -->
        <div class="p-4 space-y-4 overflow-y-auto h-[calc(100vh-80px)]">
          @for (menuItem of menuItems; track menuItem) {
            <div class="relative">
              <div class="flex items-center justify-between p-4 hover:bg-gray-50 cursor-pointer text-base font-medium transition-colors duration-200" 
                   (click)="toggleMobileSubmenu(menuItem.title)"
                   (keyup.enter)="toggleMobileSubmenu(menuItem.title)"
                   tabindex="0"
                   role="button">
                {{ menuItem.title }}
                @if (menuItem.children?.length) {
                  <svg class="w-5 h-5 transition-transform duration-300" 
                       [ngClass]="{'rotate-180': mobileSubmenuOpen[menuItem.title]}" 
                       fill="none" 
                       stroke="currentColor" 
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                }
              </div>
              @if (menuItem.children?.length) {
                <div class="pl-4 mt-2 space-y-2" 
                     [ngClass]="{'hidden': !mobileSubmenuOpen[menuItem.title]}"
                     (click)="$event.stopPropagation()">
                  @for (child of menuItem.children; track child) {
                    <a [routerLink]="getLastSegment(child.url)" [href]="getLastSegment(child.url)" 
                       class="block px-4 py-3 text-[#1A1A1A] hover:bg-gray-50 no-underline text-sm transition-colors duration-200"
                       (click)="toggleMobileMenu()">
                      {{ child.title }}
                    </a>
                  }
                </div>
              }
            </div>
          }

          <!-- Mobile Action Buttons -->
          <div class="pt-6 space-y-4 mt-6 border-t border-gray-100">
            <a [routerLink]="['/', currentLang, 'login']" [href]="'/' + currentLang + '/login'"
               class="block w-full px-4 py-4 bg-[var(--color-nimicgreen)] text-white text-center no-underline font-medium hover:bg-[#413258] transition-colors duration-200">
              {{ 'AUTH.LOGIN' | translate }}
            </a>
            <a [routerLink]="['/', currentLang, 'signup']" [href]="'/' + currentLang + '/signup'"
               class="block w-full px-4 py-4 border border-gray-700 text-gray-700 text-center no-underline font-medium hover:bg-gray-50 transition-colors duration-200">
              {{ 'AUTH.REGISTER' | translate }}
            </a>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="hidden lg:flex items-center gap-3 text-sm">
        <a [routerLink]="['/', currentLang, 'login']" [href]="'/' + currentLang + '/login'" class="bg-[var(--color-nimicgreen)] text-white px-6 py-3 text-base hover:bg-[#413258] transition border-0 font-inherit cursor-pointer no-underline">
          {{ 'AUTH.LOGIN' | translate }}
        </a>
      </div>

    </div>
  </div>
</header>
